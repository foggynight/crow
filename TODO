TODO improve error handling
TODO add nested definitions
TODO add symbolic macros
